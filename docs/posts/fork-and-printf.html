<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>fork and printf</title><meta name="keywords" content="OS"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/09a0e3bc95ae7991.css" as="style"/><link rel="stylesheet" href="/_next/static/css/09a0e3bc95ae7991.css" data-n-g=""/><link rel="preload" href="/_next/static/css/eadfbcdd63d4dae9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/eadfbcdd63d4dae9.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-581f102fc68ef277.js" defer=""></script><script src="/_next/static/chunks/main-c7d3b9909bee21b9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-89a24c62da739686.js" defer=""></script><script src="/_next/static/chunks/34-756c441760cbd96c.js" defer=""></script><script src="/_next/static/chunks/pages/posts/fork-and-printf-c49829bcb1a33369.js" defer=""></script><script src="/_next/static/8to6l2VhmwvtzctcA9gwu/_buildManifest.js" defer=""></script><script src="/_next/static/8to6l2VhmwvtzctcA9gwu/_ssgManifest.js" defer=""></script><style id="__jsx-32c93ddbf1759959">a.jsx-32c93ddbf1759959{float:right}@media screen and (max-width:480px){article.jsx-32c93ddbf1759959{padding-top:2rem;padding-bottom:4rem}}</style></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><article class="nx-container nx-prose-sm dark:nx-prose-dark md:nx-prose" dir="ltr"><h1>fork and printf</h1><div class="nx-mb-8 nx-flex nx-gap-3 nx-items-start"><div class="nx-grow nx-text-gray-400"><div class="nx-not-prose nx-flex nx-flex-wrap nx-items-center nx-gap-1"><time dateTime="2021-04-23T00:00:00.000Z">Fri Apr 23 2021</time>  •  <!-- -->1 min read</div><div class="nx-not-prose nx-mt-1 nx-flex nx-flex-wrap nx-items-center nx-gap-1"><a class="
          nx-select-none
          nx-rounded-md
          nx-bg-gray-200
          nx-px-1
          nx-text-sm
          nx-text-gray-400
          nx-transition-colors
          hover:nx-bg-gray-300
          hover:nx-text-gray-500
          dark:nx-bg-gray-600
          dark:nx-text-gray-300
          dark:hover:nx-bg-gray-700
          dark:hover:nx-text-gray-200
        " href="/tags/OS">OS</a></div></div><div class="nx-flex nx-items-center nx-gap-3"><a href="/posts">Back</a><span role="button" aria-label="Toggle Dark Mode" class="nx-cursor-pointer nx-p-2 nx-text-current" tabindex="0"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span></div></div><p><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">fork()</code> is non-deterministic, and sometime this can be a real problem. To solve this kind of problem, you may need to rely on your previous experience.</p>
<p>One day when experimenting on <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">fork()</code>, I got a strange print message:</p>
<div data-rehype-pretty-code-fragment=""><div class="nx-not-prose"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-font-medium nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4 " data-language="c" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr" data-language="c" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">main</span><span style="color:var(--shiki-color-text)">() {}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 " title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></div>
<p>I was surprised and could not figure out why for a while. Since I am using CLion and WSL 2, I soon realized that maybe it was the fault of CLion. So I ran the executable myself. A different print message came to my eyes.</p>
<p>No wonder.</p>
<p>After a long time of thinking, I related to procedures of how shells work. When you type in a command and hit enter, the shell program first creates a process to run that command. The control soon returns to the shell after the command program is finished. However, if the command program creates a subprocess, and the subprocess is still running even if the main process has already returned, this can happen.</p>
<p>In order to check my assumption, I decided to <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">wait()</code> for the child process to finish. And this time it worked perfectly.</p>
<p>Be careful of the environment you are using. Search the database in your brain.</p><a href="https://github.com/donaldnevermore/donaldnevermore.github.io/issues" target="_blank">Reply to this post on GitHub</a><small style="display:block;margin-top:8rem" class="jsx-32c93ddbf1759959"><abbr title="This site and all its content are licensed under a Creative Commons Attribution-NonCommercial 4.0 International License." style="cursor:help" class="jsx-32c93ddbf1759959">CC BY-NC 4.0</abbr> <time dateTime="2023-01-04T08:42:00.760Z" class="jsx-32c93ddbf1759959">2023</time> <!-- -->© donaldnevermore.<a href="/feed.xml" class="jsx-32c93ddbf1759959">RSS</a></small></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/fork-and-printf","query":{},"buildId":"8to6l2VhmwvtzctcA9gwu","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>